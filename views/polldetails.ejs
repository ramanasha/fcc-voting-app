<!doctype html>
<html>

    <% include ./partials/head %>

    <body>
        <% if (user) { %>
            <% include ./partials/navAuthenticated %>
        <% } else { %>
            <% include ./partials/navNotAuthenticated %>
        <% } %>

        <div class="container content">
            <div class="jumbotron">
                <div class="row">
                    <div class="col-xs-4">
                        <p><%= polldetail.name %></p>
                        <form id="pollVote">
                            <div class="form-group">
                                <label for="pollchoices">I would like to vote for...</label><br>
                                <select class="pollChoices">
                                    <% for (var i = 0; i < polldetail.choices.length; i++){ %>
                                    <option value="<%= polldetail.choices[i] %>"><%= polldetail.choices[i] %>
                                    <% } %>
                                </select>
                            </div>
                            <button class="btn btn-primary btn-lg btn-block">Vote</button><br />
                            <a href="https://twitter.com/share" class="twitter-share-button" data-via="ratracegrad" data-size="largeâ€><button class="btn btn-default btn-lg btn-block">Share on Twitter</button></a>

                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

                        </form>
                    </div>
                    <div class="col-xs-8">
                        <ul class="pollLegend text-center">
                            <% for (var i = 0; i < polldetail.choices.length; i++){ %>
                                <li> <%= polldetail.choices[i] %> </li>
                            <% } %>
                        </ul>
                        <% if (user) { %>
                            <button class="btn btn-lg btn-danger btn-block" onclick="deletePoll('<%= polldetail._id %>')">Delete Poll</button>
                        <% } %>
                     </div>
                </div>
            </div>


        </div>

        <% include ./partials/scripts %>
        <style>
            .content {
                margin-top: 75px;
            }
            .pollChoices {
                display: block;
                width: 100%;
                height: 34px;
                padding: 6px 12px;
                font-size: 14px;
                line-height: 1.5;
                background-color: white;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            .pollLegend {
                list-style: none;
            }
            .pollLegend li {
                display: inline-block;
                font-size: 14px;
            }
        </style>


        <script>
            $('#pollVote').submit(function(event){
                event.preventDefault();

                $.ajax({
                           method:     'POST',
                           url:        '/pollvote',
                           data:       $(event.target).serialize(),
                           success:    function(data) {

                           },
                           error:      function(data) {

                           }
               });
            });

            function deletePoll(whichPoll) {
                console.log('deletePoll', whichPoll);

                $.ajax({
                           method:     'DELETE',
                           url:        '/deletepoll/' + whichPoll,
                           data:       {poll: whichPoll},
                           success:    function(data) {
                               alert('Poll has been successfully deleted.');
                               window.location = '/profile';
                           },
                           error:      function(data) {
                               alert('There was an error in deleting poll. Please try again.');
                           }
                       });
            };
        </script>
    </body>
</html>